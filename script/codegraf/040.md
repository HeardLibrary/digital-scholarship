---
permalink: /script/codegraf/040/
title: CodeGraf - Sensors with CircuitPython - Running sensors remotely
breadcrumb: O40
---

[return to CircuitPython landing page](../../python/circuit/)

Previous lesson: [Programming the board](../039)

# Sensors with CircuitPython: Running sensors remotely

This lesson extends the previous two lessons by describing the modifications necessary to operate the QT Py RP2040 under battery power and to store data in its onboard memory.

**Learning objectives** At the end of this lesson, the learner will be able to:
- explain why the QT Py RP2040 cannot write data to its memory under normal operation.
- use `try...except...` clauses to prevent a Python script from terminating when an error is thrown.
- draw a sketch showing how a switch and pull-up resistor can be used to change the voltage of an input pin from high to low. 
- state how Boolean True and False states are related to voltages in a logic circuit.
- state what is special about the `boot.py` file in CircuitPython.

Total video time:  min  s

# Links

[Lesson slides](../slides/lesson040.pdf)

----

# Writing to the QT Py RP2040 memory

When operating the QT Py RP2040 microcontroller connected to a laptop, the primary use of the onboard memory is to store the Python programs that control interactions with the sensors. However, this board has a relatively large amount of onboard memory, which means that the memory can also be useful for storing data from sensors into files for later retrieval. 


## CircuitPython memory limitations (3m45s)

Because of the simplicity of CircuitPython, the memory can only be accessed by one device at a time: either from the laptop through the USB, or from the RP2040 microcontroller chip through internal connections on the board. 

Trying to write to the memory from a Python script when in read-only mode will result in an error condition. So our `code.py` script should be able to handle that error gracefully, particularly since that script will automatically run when the board is powered up. 

<iframe width="1120" height="630" src="https://www.youtube.com/embed/39tVlYYgdZ4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

.

`try ... except ...` example:

```
number_string = input('Enter a number: ')
number = int(number_string)
try:
    print(10/number)
except:
    print('Division by zero is undefined.')
```

Read-only error trapping code:

```
try:
    # use "w" to clear previous data and "a" to append new data to the end of the file
    with open("/temperature.txt", "w") as file_object:
        for count in range(10):
            print("Temp: %.2f C" % hts.temperature)
            temp = hts.temperature
            file_object.write(str(temp) + '\n') # must convert numbers to strings if using the write method
            file_object.flush() # writes the file buffer to the file after each datum is written to the buffer.
            time.sleep(delay_time)
except OSError as e:
    if e.args[0] == 30:
        print('read-only error')
    else:
        print('error', e.args[0])
```

----

## Controlling the read/write mode of memory (3m58s)

The read or write state of the onboard memory of the QT Py RP2040 can be controlled using an optional script called `boot.py` that only runs when the board first boots up. It is executed before `code.py`, so if the read/write state is set to "write" by `boot.py`, a read-only error can be avoided and the `code.py` script can write sensor data to the memory.

Unfortunately, the simplest way to control this requires soldering a physical switch between two pins of the board. However, once the switch is installed, you can easily switch between read and write modes of the memory.

<iframe width="1120" height="630" src="https://www.youtube.com/embed/gK3b3BL4pfg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

.

[pull-up resistors reference](https://learn.sparkfun.com/tutorials/pull-up-resistors/all)

[general reference on writing to a microcontroller filesystem](https://learn.adafruit.com/cpu-temperature-logging-with-circuit-python/writing-to-the-filesystem)

[additional reference on CircuitPython storage](https://learn.adafruit.com/circuitpython-essentials/circuitpython-storage)

`boot.py` script to control read/write state:

```
import board
import digitalio
import storage

switch = digitalio.DigitalInOut(board.D0)
switch.direction = digitalio.Direction.INPUT
switch.pull = digitalio.Pull.UP

# Connecting D0 to ground makes switch.value False 
storage.remount("/", switch.value)
```

----

# Flight data sensors

We will use two sensors to collect flight data during the model rocket launch. The `BMP 280` barometer sensor can also be used as an altimeter. The `LSM6DS33` 9 degrees of freedom inertial measurement unit board contains several sensors on the same board. It contains an accelerometer that can make measurements in the X, Y, and Z directions and a gyroscope that detects rotation in three dimensions. It also contains a magnetometer that we will not be using in this demonstration, but which can be used to determine the sensor's orientation within the earth's magnetic field.

## Barometer/altimeter



The following script will read and display the temperature and pressure, and display the calculated altitude on the serial REPL.

```
import time
delay_time = 1 # time to delay between multiple measurements

# Set up "board" (QT Py 2040)
import board
import busio # contains an interface for using hardware-driven I2C communication from your board

i2c = busio.I2C(board.SCL1, board.SDA1)

# pressure sensor board
import adafruit_bmp280
sensor = adafruit_bmp280.Adafruit_BMP280_I2C(i2c)

sensor.sea_level_pressure = 1011.1757554

# if True: # uncomment to capture one temperature
# while True: # uncomment for infinite loop
for count in range(10): # uncomment for 10 measurements
    print('Temp: {} C'.format(sensor.temperature)) 
    print('Pres: {} hPa'.format(sensor.pressure))
    print('Alt: {} m'.format(sensor.altitude))
    print()
    time.sleep(delay_time)
```

----

## 9 DOF accelerometer/gyroscope/magnetometer

<iframe width="1120" height="630" src="https://www.youtube.com/embed/P1IcSjyeVZU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

.


----
Revised 2022-03-15
