---
permalink: /script/codegraf/027/
title: CodeGraf - R Intro to stats - Transformations and non-parametric tests
breadcrumb: O27
---

Last lesson in beginner series: [Factors and the t-test of means](../026)

# R Intro to stats: Transformations and non-parametric tests

In this lesson, we will look at several strategies for dealing with data when a t-test of means fails to meet the assumptions of the test.

**Learning objectives** At the end of this lesson, the learner will be able to:
- list three common transformations used to fix problems with non-normal distributions.
- carry out an inverse transformation to bring statistical values back to their normal values.
- list two ways to deal with unequal variances in a t-test of means.
- carry out a Wilcoxon-Mann-Whitney (non-parametric alternative) test.
- visualize t-test results using a box and whisker plot and a violin plot.

Total video time: 24 m 47 s

# Links

[Lesson R script at GitHub](https://github.com/HeardLibrary/digital-scholarship/blob/master/code/codegraf/027/027.R)

[Lesson slides](../slides/lesson027.pdf)

----

# Transformations

## Testing for normality (3m25s)

<iframe width="1120" height="630" src="https://www.youtube.com/embed/K9gHuZDbv8o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

Code for filtering one experimental group and testing for normality:

```
# filter each color and test if normally distributed
red_tibble <- filter(erg_tidy, erg_tidy$color=="red")
hist(red_tibble$voltage)
qqnorm(red_tibble$voltage, datax = TRUE)
shapiro.test(red_tibble$voltage)
```

----

## Applying a log transformation (3m53s)

<iframe width="1120" height="630" src="https://www.youtube.com/embed/ig2d1Kr_Gao" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

Code to add a column with log-transformed data:

```
transformed_red <- mutate(red_tibble, log_col=log(voltage)) # note: natural log
```

The `log()` function returns the natural log or ln() of the argument. Base ten log could be used and would produce the same effect. 

Other transformations are: 

```
sqrt(dependent_variable) # use for counts
asin(sqrt(dependent_variable)) # use for proportions
```

Typically, for proportions a logistic regression is a better option, since it has an dependent variable that is binary (has one of two possible states). A binary outcome can be summarized as a proportion.

----

## Fixing unequal variances (1m46s)

<iframe width="1120" height="630" src="https://www.youtube.com/embed/mLT0MHYlu5I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

Code for testing for equal variance using Bartlett's test:

```
# Bartlett's test without transformation
erg_factor <- mutate(erg_tidy, color=factor(color))
bartlett.test(voltage ~ color, data=erg_tidy)
```

Note that Bartlett's test requires the independent variable to be a factor, so if manipulating the data resulted in a tibble with the independent variable converted to a character string, the conversion to a factor may need to be done prior to running the test.

Often the same transformation that fixes problems with normality will also fix problems with unequal variance. If not, in the case of the t-test of means, there is a variant of the test for unequal variances. In that case, set `var.equal=FALSE`:

```
t.test(voltage ~ color, data=transformed_factor, var.equal=FALSE)
```

----

## Test results after transformation (3m31s)

<iframe width="1120" height="630" src="https://www.youtube.com/embed/S-8WLp2Hn_g" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

When reporting statistical quantities following a test using transformed variables, you should back-transform the quantities so that they have the same scale as the original quantities. To back transform, use the inverse property to the property you used for the transformation.

In the case of the `log(variable)` (natural log) transformation, use `exp(transformed_variable)`, which raises `e` to the power of the argument.

In the case of the `sqrt(variable)` transformation, use `transformed_variable^2` (square the transformed quantity).

----

# Non-parametric tests

## Using a non-parametric test (6m13s)

<iframe width="1120" height="630" src="https://www.youtube.com/embed/BPJfE26mUqc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

Most parametric tests have an alternative non-parametric test that can be used with the same type of data. In the case of the t-test of means, the Wilcoxon rank sum/Mann-Whitney U test can be used instead. We refer to it as the Wilcoxon-Mann-Whitney (WMW) test. The format of the test is:

```
# perform the test on untransformed data since non-parametric
wilcox.test(voltage ~ color, data=erg_factor)
```

As with similar functions, the `data=` argument can be omitted if the dependent and independent variables are input as vectors or as columns where the data frame is explicitly specified using the "$" notation.

----

## Visualization options for t-test of means (5m59s)

<iframe width="1120" height="630" src="https://www.youtube.com/embed/V5Sf3Se0bIE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

An appropriate visualization for t-test of means is a box-and-whisker plot:

```
plot(dependent_variable ~ independent_variable, data=data_frame)
```

A better visualization would use 95% confidence intervals for the error bars, but generating such a plot is beyond the scope of this lesson.

The `ggplot2` package makes it possible to generate presentation-quality plots where the appearance can be precisely controlled. Here is an example of a box plot using the `ggplot()` function from that package:

```
ggplot(data = erg_factor, aes(x=color, y=voltage, color=color)) + geom_boxplot()
```

An alternative is a "violin" plot, which provides an indication of the "shape" of the distribution:

```
ggplot(data = erg_factor, aes(x=color, y=voltage, color=color)) + geom_violin()
```

Both plots can be overlaid using this code:

```
ggplot(data = erg_factor, aes(x=color, y=voltage, color=color)) +
  geom_boxplot() +
  geom_violin(alpha = 0.3)
```
The alpha parameter controls the transparency, making it possible to see the box plot without the violing plot obscuring it.

----

# Practice assignment

For the first 5 questions, use the fake smoking/BMI data at 

```
read.csv("https://raw.githubusercontent.com/HeardLibrary/digital-scholarship/master/code/codegraf/027/fake_bmi_smoking_data.csv")
```

1. Load

2

Next lesson: [x](../028)

----
Revised 2020-10-21
